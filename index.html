const scriptURL = "COLE_AQUI_O_URL_DO_APPS_SCRIPT"; // URL do Apps Script

async function atualizarVagas() {
  const res = await fetch(scriptURL);
  const data = await res.json();
  vagasRestantes = data.vagasRestantes;
  totalVagas = data.totalVagas;
  vagasRestantesSpan.innerText = vagasRestantes;
  atualizarBarra();
  atualizarQuantidadeOptions();
}

async function enviarWhatsApp() {
  const nomes = document.getElementById('nomes').value.trim();
  const qtd = parseInt(quantidadeSelect.value);

  if (!nomes) {
    alert("Preencha o nome!");
    return;
  }

  // Chama o Apps Script para reservar as vagas
  const res = await fetch(`${scriptURL}?qtd=${qtd}&action=reservarVagas`);
  const data = await res.json();

  if (!data.success) {
    alert(data.message);
    await atualizarVagas();
    return;
  }

  vagasRestantes = data.vagasRestantes;
  vagasRestantesSpan.innerText = vagasRestantes;
  atualizarBarra();
  atualizarQuantidadeOptions();

  const valorTotal = qtd * valorPorPessoa;
  const mensagem = `Olá, segue a minha reserva:\nNome(s): ${nomes}\nQuantidade de vagas: ${qtd}\nValor total: R$ ${valorTotal}\nComprovante do PIX anexado.`;
  const numeroWhatsApp = "5566996926174";
  window.open(`https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`, "_blank");

  if (vagasRestantes <= 0) {
    alert("Vagas lotadas! Entre em contato via WhatsApp para verificar outro ônibus.");
  }
}

